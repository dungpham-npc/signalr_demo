@page
@model PhamAnhDungRazorPages.Pages.News.DeleteModel
@{
    Layout = null;
}

<form id="deleteForm">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" value="@Model.NewsArticleId"/>
    <h3>Are you sure you want to delete this article?</h3>
    <div class="mt-3">
        <button type="submit" class="btn btn-danger">Delete</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
    </div>
</form>

<script>
    $(document).ready(function() {
        $('#deleteForm').submit(function(e) {
            e.preventDefault();

            let articleId = @Model.NewsArticleId;
            console.log("Sending Delete Request for ID:", articleId);

            $.ajax({
                url: '/News/Delete?handler=Delete',
                type: 'POST',
                data: { id: articleId },
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                success: function(response) {
                    console.log("Delete Response:", response);
                    if (response && response.success) {
                        closeModal();
                        if (typeof connection !== 'undefined') {
                            connection.invoke("SendUpdate", "Article deleted");
                        }
                        alert("Article deleted successfully.");
                        window.location.href = '/News';
                    } else {
                        alert(response ? response.message : 'Unexpected error.');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Delete Error:', error, "Response:", xhr.responseText);
                    alert('Error deleting article: ' + (xhr.responseText || error));
                }
            });
        });

    });

    function closeModal() {
        $('.modal').hide();
    }
</script>
